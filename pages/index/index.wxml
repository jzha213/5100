<!--index.wxml - 首页美化布局-->
<view class="container">
  <!-- 自定义导航栏 -->
  <view class="custom-navbar" style="padding-top: {{statusBarHeight}}px;">
    <view class="navbar-content">
      <!-- 左上角头像图标，点击跳转“我的”页面 -->
      <view class="navbar-logo" bindtap="goProfile">
        <view class="navbar-logo-icon">
          <!-- 已登录且有头像：显示用户头像 -->
          <image 
            wx:if="{{avatarUrl}}" 
            src="{{avatarUrl}}" 
            mode="aspectFill" 
            style="width: 100%; height: 100%; border-radius: 50%;"
          ></image>
          <!-- 未登录或无头像：显示蓝色人形图标（蓝头像 + 白色圆形背景） -->
          <view wx:else class="navbar-logo-default-avatar">
            <view class="navbar-logo-default-head"></view>
            <view class="navbar-logo-default-body"></view>
          </view>
        </view>
        <!-- 头像右侧的 “>” 图标 -->
        <text class="navbar-logo-arrow">></text>
      </view>
      
      <!-- 导航栏标题 -->
      <view class="navbar-title">首页</view>
      
      <!-- 右侧占位，保持标题居中 -->
      <view class="navbar-placeholder"></view>
    </view>
  </view>

  <!-- 头部区域 -->
  <view class="header">
    <!-- 搜索栏 -->
    <view class="search-bar">
      <text class="search-icon">🔍</text>
      <input 
        placeholder="搜索商品..." 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        bindconfirm="onSearchConfirm"
        confirm-type="search"
      />
    </view>
  </view>

  <!-- 推荐商品轮播 -->
  <view class="banner-swiper">
    <swiper 
      class="product-swiper" 
      indicator-dots="{{true}}" 
      autoplay="{{bannerAutoplay}}" 
      interval="{{3000}}" 
      duration="{{500}}"
      circular="{{true}}"
      current="{{bannerCurrent}}"
      indicator-color="rgba(255,255,255,0.5)"
      indicator-active-color="#ffffff"
      bindchange="onBannerChange"
    >
      <swiper-item 
        wx:for="{{bannerProducts}}" 
        wx:key="id"
        bindtap="goProductDetail"
        data-id="{{item.id}}"
      >
        <view class="swiper-product-item">
          <image class="swiper-product-image" src="{{item.mainImage}}" mode="aspectFit"></image>
          <view class="swiper-product-content">
            <view class="swiper-product-title">{{item.name}}</view>
            <view class="swiper-product-desc">{{item.description || '优质商品，值得信赖'}}</view>
            <view class="swiper-product-price">¥{{item.price}}</view>
          </view>
        </view>
      </swiper-item>
    </swiper>
  </view>

  <!-- 内容区域 -->
  <view class="content">
    <!-- 分类区域 -->
    <view class="categories">
      <view class="section-title">商品分类</view>
      
      <!-- 动态分类网格 -->
      <view class="category-grid">
        <view 
          class="category-item" 
          wx:for="{{categories}}" 
          wx:key="id"
          bindtap="onCategoryTap"
          data-id="{{item.id}}"
          data-name="{{item.name}}"
        >
          <view class="category-icon">
            <image 
              wx:if="{{item.icon_url}}" 
              class="category-icon-image" 
              src="{{item.icon_url}}" 
              mode="aspectFill"
            ></image>
            <text wx:else class="category-icon-emoji">💧</text>
          </view>
          <text class="category-name">{{item.name}}</text>
        </view>
        
        <!-- 显示更多按钮 -->
        <view class="category-item more-btn" bindtap="goCategory">
          <view class="category-icon">
            <text class="category-icon-emoji">➕</text>
          </view>
          <text class="category-name">更多</text>
        </view>
      </view>
    </view>

    <!-- 推荐商品 -->
    <view class="featured-products">
      <view class="section-title">推荐商品</view>
      
      <!-- 动态推荐商品网格 -->
      <view class="product-grid">
        <view 
          class="product-card" 
          wx:for="{{featuredProducts}}" 
          wx:key="id"
          wx:for-item="product"
          wx:for-index="productIndex"
          bindtap="goProductDetail"
          data-id="{{product.id}}"
        >
          <view class="product-image">
            <image src="{{product.mainImage}}" mode="aspectFit" wx:if="{{product.mainImage}}"></image>
            <text wx:else>💧</text>
            <view class="product-badge" wx:if="{{product.is_featured}}">推荐</view>
          </view>
          <view class="product-info">
            <text class="product-name">{{product.name}}</text>
            <text class="product-desc">{{product.description || '优质商品，值得信赖'}}</text>
            <view class="product-price">
              <text class="price">¥{{product.price}}</text>
            </view>
          </view>
        </view>
        
        <!-- 更多推荐商品按钮 -->
        <view class="product-card more-products-btn" bindtap="goFeaturedProducts">
          <view class="product-image">
            <text>➕</text>
          </view>
          <view class="product-info">
            <text class="product-name">更多推荐</text>
            <text class="product-desc">查看更多推荐商品</text>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>

