<!--pages/cart/cart.wxml-->
<view class="container">
  <!-- æœªç™»å½•çŠ¶æ€ -->
  <view wx:if="{{!isLoggedIn}}" class="login-prompt">
    <view class="prompt-icon">ğŸ”’</view>
    <text class="prompt-title">è¯·å…ˆç™»å½•</text>
    <text class="prompt-desc">ç™»å½•åå³å¯æŸ¥çœ‹è´­ç‰©è½¦</text>
    <view class="prompt-buttons">
      <button class="btn-primary" bindtap="goToLogin">å»ç™»å½•</button>
      <button class="btn-secondary" bindtap="goToRegister">æ³¨å†Œè´¦å·</button>
    </view>
  </view>
  
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:elif="{{loading}}" class="loading">
    <text>åŠ è½½ä¸­...</text>
  </view>
  
  <!-- ç©ºè´­ç‰©è½¦çŠ¶æ€ -->
  <view wx:elif="{{cartItems.length === 0}}" class="empty-cart">
    <view class="empty-icon">ğŸ›’</view>
    <text class="empty-text">è´­ç‰©è½¦æ˜¯ç©ºçš„</text>
    <button class="btn-primary" bindtap="goShopping">å»è´­ç‰©</button>
  </view>
  
  <!-- è´­ç‰©è½¦å†…å®¹ -->
  <view wx:else>
    <!-- è´­ç‰©è½¦å•†å“åˆ—è¡¨ -->
    <view class="cart-list">
      <view 
        class="cart-item" 
        wx:for="{{cartItems}}" 
        wx:key="id"
      >
        <!-- å•†å“ä¿¡æ¯åŒºåŸŸ -->
        <view class="item-content">
          <view class="item-checkbox">
            <checkbox checked="{{item.selected}}" bindtap="toggleItem" data-id="{{item.id}}"/>
          </view>
          
          <view class="item-image">
            <image src="{{item.product.mainImage}}" mode="aspectFit"></image>
          </view>
          
          <view class="item-info">
            <text class="item-name">{{item.product.name}}</text>
            <text class="item-sku">SKU: {{item.product.sku}}</text>
            <view class="item-price-row">
              <text class="item-price">Â¥{{item.product.price}}</text>
              <text class="item-quantity">x{{item.quantity}}</text>
            </view>
          </view>
        </view>
        
        <!-- æ“ä½œåŒºåŸŸ -->
        <view class="item-actions">
          <view class="quantity-controls">
            <button class="quantity-btn" bindtap="decreaseQuantity" data-id="{{item.id}}">-</button>
            <input class="quantity-input" type="number" value="{{item.quantity}}" bindinput="onQuantityChange" data-id="{{item.id}}"/>
            <button class="quantity-btn" bindtap="increaseQuantity" data-id="{{item.id}}">+</button>
          </view>
          <button class="delete-btn" bindtap="deleteItem" data-id="{{item.id}}">åˆ é™¤</button>
        </view>
        
        <!-- åœ°å€ä¿¡æ¯ -->
        <view class="item-address" wx:if="{{item.address_info}}">
          <text class="address-label">æ”¶è´§åœ°å€ï¼š</text>
          <text class="address-text">{{item.address_info.full_address}}</text>
        </view>
        
        <!-- å¤‡æ³¨ä¿¡æ¯ -->
        <view class="item-notes" wx:if="{{item.notes}}">
          <text class="notes-label">å¤‡æ³¨ï¼š</text>
          <text class="notes-text">{{item.notes}}</text>
        </view>
        
        <!-- å°è®¡ -->
        <view class="item-subtotal">
          <text class="subtotal-label">å°è®¡ï¼š</text>
          <text class="subtotal-price">Â¥{{item.product.price * item.quantity}}</text>
        </view>
      </view>
    </view>
    
    <!-- åº•éƒ¨ç»“ç®—æ  -->
    <view class="checkout-bar">
      <view class="select-all">
        <checkbox checked="{{allSelected}}" bindtap="toggleAll"/>
        <text>å…¨é€‰</text>
      </view>
      
      <view class="total-info">
        <text class="total-label">åˆè®¡ï¼š</text>
        <text class="total-price">Â¥{{totalPrice}}</text>
      </view>
      
      <button class="btn-checkout" bindtap="checkout" disabled="{{selectedCount === 0}}">
        ç»“ç®—({{selectedCount}})
      </button>
    </view>
  </view>
</view>